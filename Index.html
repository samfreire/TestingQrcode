<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Leitor de Nota Fiscal Web</title>
<style>
  body { font-family: Arial; padding: 16px; }
  video { width: 100%; border: 1px solid #ccc; border-radius: 8px; }
  #resultado { white-space: pre-wrap; margin-top: 20px; }
  button { margin-top: 10px; padding: 10px 18px; font-size: 16px; }
</style>
</head>

<body>
<h2>ðŸ“¸ Leitor de Nota Fiscal - Web</h2>

<video id="camera" autoplay playsinline></video>
<button onclick="scanQr()">Ler QR Code</button>
<button onclick="capturarImagem()">Ler Imagem / Nota</button>

<h3>Resultado:</h3>
<div id="resultado"></div>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
const video = document.getElementById("camera");
const resultado = document.getElementById("resultado");

navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(stream => video.srcObject = stream);

function scanQr() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const code = jsQR(imageData.data, canvas.width, canvas.height);

  if (code) {
    resultado.innerHTML = "QR Code Detectado:<br>" + code.data;
    fetch(code.data)
      .then(r => r.text())
      .then(xml => resultado.innerHTML += "\n\nDados da Nota:\n" + xml);
  } else {
    resultado.innerHTML = "Nenhum QR encontrado. Aproxime da nota.";
  }
}

function capturarImagem() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  canvas.toBlob(blob => {
    Tesseract.recognize(blob, 'por', {})
      .then(r => resultado.innerHTML = r.data.text);
  });
}
</script>
</body>
</html>
